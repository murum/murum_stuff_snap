function showPreview(e){var i=255/e.w,t=172/e.h,a=$("img#image-cropper").height(),r=$("img#image-cropper").width();$("img#image-preview").css({width:Math.round(t*r)+"px",height:Math.round(t*a)+"px",marginLeft:"-"+Math.round(i*e.x)+"px",marginTop:"-"+Math.round(t*e.y)+"px"}),$('input[name="x"]',"form.image-form-update").attr("value",e.x),$('input[name="y"]',"form.image-form-update").val(e.y),$('input[name="w"]',"form.image-form-update").val(e.w),$('input[name="h"]',"form.image-form-update").val(e.h),$('input[name="image-width"]',"form.image-form-update").val(r),$('input[name="image-height"]',"form.image-form-update").val(a)}function progressHandlingFunction(e){e.lengthComputable&&$("progress").attr({value:e.loaded,max:e.total})}$(function(){$(".selectpicker").selectpicker(),$("a.toggle-additional-user-fields").on("click",function(e){e.preventDefault(),$("a.toggle-additional-user-fields").show(),$(this).hide(),$("div.additional-user-fields").toggleClass("hidden")}),$("input#image").fileinput({showPreview:!1,showRemove:!1,showUpload:!1}),$("input#image").on("change",function(){$("form.image-form").trigger("submit")}),$("a#reupload-image").on("click",function(){confirm("Are you sure you want to reset your image?")&&$("form.image-form").trigger("submit")}),$("a.skip-image").on("click",function(){$(".step-image").toggleClass("hidden"),$(".step-fields").length&&$(".step-fields").toggleClass("hidden")}),$("a.skip-crop").on("click",function(){$(".step-crop").toggleClass("hidden"),$(".step-fields").length&&$(".step-fields").toggleClass("hidden")}),$("a.show-crop").on("click",function(){$("div.image-cropper-container").toggleClass("hidden"),$("div.cropper-buttons").toggleClass("hidden"),$("div.cropper-buttons-first").toggleClass("hidden")}),$("form.image-form").on("submit",function(e){e.preventDefault();{var i=new FormData($("form.image-form")[0]),t=$(this).attr("action"),a=$(this).attr("method");$(this)}$.ajax({url:t,type:a,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",progressHandlingFunction,!1),e},success:function(e){var i=$("img#image-cropper").data("Jcrop");i&&i.destroy(),$("div.step-image").addClass("hidden"),$("div.step-crop").removeClass("hidden"),$("div.cropper-buttons").addClass("hidden"),$("div.cropper-buttons-first").removeClass("hidden"),$("img#image-cropper").attr("src","/"+e.url).show(),$("img#image-preview").attr("src","/"+e.url),$('input[name="image-url"]',"form.image-form-update").val(e.url),$('input[name="image"]',"form.form-user-create").val(e.url),$("img#image-cropper").Jcrop({onChange:showPreview,onSelect:showPreview,aspectRatio:255/172}),setTimeout(function(){$("div.image-cropper-container").toggleClass("hidden")},50)},data:i,cache:!1,contentType:!1,processData:!1})}),$("form.image-form-update").on("submit",function(e){if(e.preventDefault(),0==$("div.jcrop-hline").width())return $("a.skip-crop").trigger("click"),!1;var i=$(this).serializeArray(),t=$(this).attr("action"),a=$(this).attr("method");$.ajax({url:t,type:a,success:function(e){$('input[name="image"]',"form.form-user-create").val(e.url),$(".step-fields").removeClass("hidden"),$(".step-crop").addClass("hidden")},data:i})})});